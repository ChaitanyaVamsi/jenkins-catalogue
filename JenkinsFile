pipeline{

  // agent any
  agent{
    node{
      label 'slave'
    }
  }

  environment{
    COURSE = "Jenkins"
    PROJECT = "roboshop"
    COMPONENT = "catalogue"
    appVersion = ""
  }

  options{
    timeout(time:10, unit: 'MINUTES')
    disableConcurrentBuilds()
  }

  stages{
    // need a plugin for this - Pipeline Utility Steps
    stage ('Display Version'){
        steps{
          script{
            def packageJSON = readJSON file: 'package.json'
            appVersion= packageJSON.version // this appVersion is defined in environment
            echo "app version: ${appVersion}"
          }
        }
    }

    stage('install dependencies'){
      steps{
        script{
          sh """
              npm install

          """
        }
      }
    }

    stage('Build Image'){
      steps{
        script{
          sh """
              docker build -t catalogue:${appVersion} .
          """
        }
      }
    }


  }
}